"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const ui_1 = require("../ui");
const cross_spawn_1 = require("cross-spawn");
const fs = tslib_1.__importStar(require("fs"));
const path = tslib_1.__importStar(require("path"));
class NpmInstaller {
    constructor(logger) {
        this.logger = logger;
    }
    static dependenciesFileExists(directory) {
        const filepath = path.join(directory, 'package.json');
        return fs.existsSync(filepath);
    }
    install(directory) {
        return new Promise((resolve) => {
            if (NpmInstaller.dependenciesFileExists(directory)) {
                this.logger.info(ui_1.Text.create.taskPackages);
                const process = cross_spawn_1.spawn('npm', ['install', '--no-package-lock'], { cwd: directory });
                process.on('exit', resolve);
                process.on('error', () => {
                    this.logger.warn(ui_1.Text.create.error.packages.installFail);
                    resolve();
                });
            }
            else {
                resolve();
            }
        });
    }
}
exports.NpmInstaller = NpmInstaller;
